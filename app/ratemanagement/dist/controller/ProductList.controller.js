sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/core/Fragment","sap/ui/export/library","sap/ui/export/Spreadsheet","sap/m/MessageBox"],(e,t,i,r,a,o)=>{"use strict";var n=r.EdmType;return e.extend("rwt.etp.ratemanagement.controller.ProductList",{onInit(){this._oView=this.getView();this._ServerModel=this.getOwnerComponent().getModel();this._ServerModel.setSizeLimit(1e3)},onAddNewPrs:function(){var e=this.getView();if(!this.byId("newRowDialog")){this.loadFragment({name:"rwt.etp.ratemanagement.fragment.AddProduct"}).then(function(t){e.addDependent(t);t.open()}.bind(this))}else{this.byId("newRowDialog").open()}},onSaveNewRow:function(){var e=this.getView();var i=this;var r=this.byId("productCodeInput").getValue();var a=this.byId("productNameInput").getValue();var o=this.byId("packagingQtyInput").getValue();var n=this.byId("unitInput").getValue();var s=this.byId("costPriceInput").getValue();var c=this.byId("landingPriceInput").getValue();var l=this.byId("sellingPriceInput").getValue();var u=this.byId("stockInput").getValue();var d={ProductCode:r,Product:a,Packaging_Qty:o,Unit:n,Cost_Price:s,Landing_Price:c,Selling_Price:l,Available_Qty:u};var g=this.byId("idTable");var h=g.getBinding("items");var p=h.create(d);p.created().then(function(){t.show("New Product Added");e.byId("newRowDialog").close();i._ServerModel.refresh()},function(e){if(!e.canceled){throw e}})},onCancelNewRow:function(){this.byId("newRowDialog").close()},onRowEdit:function(e){var t=e.getSource().getParent().getParent();var i=t.getCells();i.forEach(function(e){if(e.isA("sap.m.Input")){e.setEditable(true)}});e.getSource().setIcon("sap-icon://save");e.getSource().setTooltip("Save Changes");e.getSource().detachPress(this.onRowEdit);e.getSource().attachPress(this.onRowSave,this)},onRowSave:function(e){var i=e.getSource().getParent().getParent();var r=this;var a=i.getCells();a.forEach(function(e){if(e.isA("sap.m.Input")){e.setEditable(false)}});e.getSource().setIcon("sap-icon://edit");e.getSource().setTooltip("Edit Row");e.getSource().detachPress(this.onRowSave);e.getSource().attachPress(this.onRowEdit,this);var o=i.getBindingContext();this._ServerModel.submitBatch("updateGroup").then(function(){t.show("Changes saved successfully!");r._ServerModel.refresh()}).catch(function(e){t.show("Failed to save changes.");console.error(e)})},onRowDel:function(e){var t=e.getSource().getParent();var i=t.getBindingContext();var r=this;o.confirm("Are you sure you want to delete this item?",{onClose:function(e){if(e===o.Action.OK){r._ServerModel.delete(i.getPath()).then(function(){sap.m.MessageToast.show("Item deleted successfully.")}).catch(function(e){o.error("Failed to delete item: "+e.message)})}}})},createColumnConfig:function(){var e=[];e.push({label:"Product",property:"Product",type:n.String,width:50});e.push({label:"Product Code",type:n.String,property:"ProductCode"});e.push({property:"Packaging_Qty",label:"Packaging Quantity",type:n.Number});e.push({label:"Unit",property:"Unit",type:n.Number});e.push({label:"Cost Price",property:"Cost_Price",type:n.Number,width:15});e.push({label:"Landing Price",property:"Landing_Price",type:n.Number,scale:2,width:15});e.push({label:"Selling Price",property:"Selling_Price",type:n.Number,scale:2,width:15});e.push({label:"Available Stock",property:"Available_Qty",type:n.Number,scale:2,width:15});return e},onDwnldPrs:function(){let e="RateList";const t=new Date;let i=this.byId("idTable");const r=String(t.getDate()).padStart(2,"0");const o=String(t.getMonth()+1).padStart(2,"0");const n=String(t.getFullYear()).slice(-2);const s=`${r}${o}${n}`;e+="_"+s;var c,l,u,d;l=i.getBinding("items");c=this.createColumnConfig();u={workbook:{context:{application:"Rate List",version:"6.1.0-SNAPSHOT",title:"Rate List",modifiedBy:"Rawat, Enterprises",sheetName:"RateList"},columns:c,hierarchyLevel:"Level"},dataSource:l,fileName:e+".xlsx",worker:false};d=new a(u);d.build().finally(function(){d.destroy()})}})});
//# sourceMappingURL=ProductList.controller.js.map