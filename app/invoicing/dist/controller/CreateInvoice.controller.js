sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/export/library","sap/ui/export/Spreadsheet"],(e,t,o,r,i)=>{"use strict";var n=r.EdmType;return e.extend("rwt.etp.invoicing.controller.CreateInvoice",{onInit:function(){this._oView=this.getView();this._ProductData=this.getOwnerComponent().getModel("ProductModel");this._ServerModel=this.getOwnerComponent().getModel();this._ServerModel.bindList("/Products").requestContexts(0,1e3).then(function(e){let t=e.map(function(e){e.getObject().Selling_Price=parseInt(e.getObject().Selling_Price);e.getObject().Cost_Price=parseInt(e.getObject().Cost_Price);return e.getObject()});this._ProductData.setData(t)}.bind(this)).catch(function(e){console.error("Error while fetching from server OData:",e)})},onSuggestionItemSelected:function(e){let t=e.getParameter("selectedItem");if(t){let o=t.getKey().split("--");let r=this._ProductData.getProperty("/");let i=r.find(e=>e.ProductCode===o[0]&&e.Packaging_Qty==o[1]);let n=this._oView.getModel("InvoiceModel");let l=n.getProperty("/");if(!Array.isArray(l)){l=[]}i.Sell_Qty=1;i.TotalPrice=i.Selling_Price;l.push(i);n.setProperty("/",l);n.updateBindings();e.getSource().setValue()}},updateSP:function(e){let t=e.getSource().getParent();let o=t.getBindingContextPath();let r=this.getView().getModel("InvoiceModel");let i=t.getAggregation("cells")[5].getValue();r.setProperty(`${o}/Selling_Price`,parseInt(i));let n=t.getAggregation("cells")[3].getValue();r.setProperty(`${o}/Sell_Qty`,n);let l=r.getProperty(`${o}/Selling_Price`);let s=r.setProperty(`${o}/TotalPrice`,parseInt(l)*n);r.refresh(true)},onTblUpdateFinsh:function(e){const t=this.byId("idTable");const o=t.getItems();let r=0;let i=0;o.forEach(e=>{const t=e.getBindingContext("InvoiceModel");if(t){const e=parseFloat(t.getProperty("TotalPrice"))||0;r+=e}});this.byId("idTotlVal").setText(r.toFixed(2))},onDelRow:function(e){const t=e.getSource();const o=t.getBindingContext("InvoiceModel");if(o){const e=o.getPath();const t=this.getView().getModel("InvoiceModel");const r=t.getProperty("/");const i=parseInt(e.split("/").pop());r.splice(i,1);t.setProperty("/",r);sap.m.MessageToast.show("Row deleted successfully")}},onResetPrs:function(){this.getView().getModel("InvoiceModel").setData().refresh(true)},createColumnConfig:function(){var e=[];e.push({label:"Product",property:"Product",type:n.String,width:50});e.push({label:"Product Code",type:n.String,property:"ProductCode"});e.push({property:["Packaging_Qty","Unit"],label:"Packing",type:n.String,width:10,template:"{0} {1}"});e.push({label:"Cost Price",property:"Cost_Price",type:n.Number,width:15});e.push({label:"Selling Price (incl. GST)",property:"Selling_Price",type:n.Number,scale:2,width:15});e.push({label:"Quantity",property:"Sell_Qty",type:n.Number,scale:2,width:15});e.push({label:"Total",property:"TotalPrice",type:n.Number,scale:2,width:15});return e},onPrntPrs:function(){let e=this.byId("idCustmrNm").getValue();if(!e){t.show("Enter Customer Name");return}const o=new Date;let r=this.byId("idTable");let n=r.getModel("InvoiceModel");let l=n.getProperty("/");const s=String(o.getDate()).padStart(2,"0");const c=String(o.getMonth()+1).padStart(2,"0");const a=String(o.getFullYear()).slice(-2);const g=`${s}${c}${a}`;e+="_"+g+"_"+this.byId("idTotlVal").getText();var p,d,u,h;d=r.getBinding("items");p=this.createColumnConfig();u={workbook:{context:{application:"Supplier Invoices List",version:"6.1.0-SNAPSHOT",title:"Supplier Invoices",modifiedBy:"Doe, John",sheetName:"Invoices"},columns:p,hierarchyLevel:"Level"},dataSource:d,fileName:e+".xlsx",worker:false};h=new i(u);h.build().finally(function(){h.destroy()})}})});
//# sourceMappingURL=CreateInvoice.controller.js.map