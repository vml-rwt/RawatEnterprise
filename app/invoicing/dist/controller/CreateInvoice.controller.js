sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/export/library","sap/ui/export/Spreadsheet"],(e,t,o,i,r)=>{"use strict";return e.extend("rwt.etp.invoicing.controller.CreateInvoice",{onInit:function(){this._oView=this.getView();this._ProductData=this.getOwnerComponent().getModel("ProductModel");this._ServerModel=this.getOwnerComponent().getModel();this._ServerModel.bindList("/Products").requestContexts(0,1e3).then(function(e){let t=e.map(function(e){return e.getObject()});this._ProductData.setData(t)}.bind(this)).catch(function(e){console.error("Error while fetching from server OData:",e)})},onSuggestionItemSelected:function(e){let t=e.getParameter("selectedItem");if(t){let o=t.getKey().split("--");let i=this._ProductData.getProperty("/");let r=i.find(e=>e.ProductCode===o[0]&&e.Packaging_Qty==o[1]);let n=this._oView.getModel("InvoiceModel");let l=n.getProperty("/");if(!Array.isArray(l)){l=[]}r.Sell_Qty=1;r.TotalPrice=r.Selling_Price;l.push(r);n.setProperty("/",l);n.updateBindings();e.getSource().setValue()}},updateSP:function(e){let t=e.getSource();let o=t.getParent().getBindingContextPath();let i=this.getView().getModel("InvoiceModel");let r=i.getProperty(`${o}/Selling_Price`);let n=i.setProperty(`${o}/TotalPrice`,r*t.getValue());i.refresh(true)},onTblUpdateFinsh:function(e){const t=e.getSource();const o=t.getItems();let i=0;let r=0;o.forEach(e=>{const t=e.getBindingContext("InvoiceModel");if(t){const e=parseFloat(t.getProperty("TotalPrice"))||0;i+=e}});this.byId("idTotlVal").setText(i.toFixed(2))},onDelRow:function(e){const t=e.getSource();const o=t.getBindingContext("InvoiceModel");if(o){const e=o.getPath();const t=this.getView().getModel("InvoiceModel");const i=t.getProperty("/");const r=parseInt(e.split("/").pop());i.splice(r,1);t.setProperty("/",i);sap.m.MessageToast.show("Row deleted successfully")}},onResetPrs:function(){this.getView().getModel("InvoiceModel").setData().refresh(true)},createColumnConfig:function(){var e=[];e.push({label:"Product",property:"Product",type:EdmType.String,width:50});e.push({label:"Product Code",type:EdmType.String,property:"ProductCode"});e.push({property:["Qty","Unit"],label:"Quantity",type:EdmType.String,width:10,template:"{0} {1}"});e.push({label:"Cost Price",property:"Cost_Price",type:EdmType.Number,width:15});e.push({label:"Selling Price (incl. GST)",property:"Final_Price",type:EdmType.Number,scale:2,width:15});return e},onPrntPrs:function(){let e=this.byId("idCustmrNm").getValue();if(!e){t.show("Enter Customer Name");return}const o=new Date;let i=this.byId("idTable");let n=i.getModel("InvoiceModel");let l=n.getProperty("/");let s=l.map(e=>{let t=parseFloat(e.Selling_Price)||0;let o=t*.18;e.Final_Price=(t+o).toFixed(2);return e});const c=String(o.getDate()).padStart(2,"0");const a=String(o.getMonth()+1).padStart(2,"0");const d=String(o.getFullYear()).slice(-2);const p=`${c}${a}${d}`;e+="_"+p+"_"+this.byId("idTotlVal").getText();var u,g,h,y;g=i.getBinding("items");u=this.createColumnConfig();h={workbook:{context:{application:"Supplier Invoices List",version:"6.1.0-SNAPSHOT",title:"Supplier Invoices",modifiedBy:"Doe, John",sheetName:"Invoices"},columns:u,hierarchyLevel:"Level"},dataSource:g,fileName:e+".xlsx",worker:false};y=new r(h);y.build().finally(function(){y.destroy()})}})});
//# sourceMappingURL=CreateInvoice.controller.js.map