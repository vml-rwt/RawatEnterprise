sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/export/library","sap/ui/export/Spreadsheet"],(e,t,i,o,r)=>{"use strict";var l=o.EdmType;return e.extend("rwt.etp.invoicing.controller.CreateInvoice",{onInit:function(){this._oView=this.getView();this._ProductData=this.getOwnerComponent().getModel("ProductModel");this._ServerModel=this.getOwnerComponent().getModel();this._ProductData.setSizeLimit(1e3);this._ServerModel.setSizeLimit(1e3);this._ServerModel.bindList("/Products").requestContexts(0,1e3).then(function(e){let t=e.map(function(e){e.getObject().Selling_Price=parseInt(e.getObject().Selling_Price);e.getObject().Cost_Price=parseInt(e.getObject().Cost_Price);e.getObject().Available_Qty=parseInt(e.getObject().Available_Qty);return e.getObject()});this._ProductData.setData(t)}.bind(this)).catch(function(e){console.error("Error while fetching from server OData:",e)})},onSuggestionItemSelected:function(e){let t=e.getParameter("selectedItem");if(t){let i=t.getKey().split("--");let o=this._ProductData.getProperty("/");let r=o.find(e=>e.ProductCode===i[0]&&e.Packaging_Qty==i[1]);let l=this._oView.getModel("InvoiceModel");let n=l.getProperty("/");if(!Array.isArray(n)){n=[]}r.Sell_Qty=1;r.TotalPrice=r.Selling_Price;n.push(r);l.setProperty("/",n);l.updateBindings();e.getSource().setValue()}},updateSP:function(e){let t=e.getSource().getParent();let i=t.getBindingContextPath();let o=this.getView().getModel("InvoiceModel");let r=t.getAggregation("cells")[5].getValue();o.setProperty(`${i}/Selling_Price`,parseInt(r));let l=t.getAggregation("cells")[3].getValue();o.setProperty(`${i}/Sell_Qty`,l);let n=o.getProperty(`${i}/Selling_Price`);let s=o.setProperty(`${i}/TotalPrice`,parseInt(n)*l);o.refresh(true)},onTblUpdateFinsh:function(e){const t=this.byId("idTable");const i=t.getItems();let o=0;let r=0;i.forEach(e=>{const t=e.getBindingContext("InvoiceModel");if(t){const e=parseFloat(t.getProperty("TotalPrice"))||0;o+=e}});this.byId("idTotlVal").setText(o.toFixed(2))},onDelRow:function(e){const t=e.getSource();const i=t.getBindingContext("InvoiceModel");if(i){const e=i.getPath();const t=this.getView().getModel("InvoiceModel");const o=t.getProperty("/");const r=parseInt(e.split("/").pop());o.splice(r,1);t.setProperty("/",o);sap.m.MessageToast.show("Row deleted successfully")}},onResetPrs:function(){this.getView().getModel("InvoiceModel").setData().refresh(true)},createColumnConfig:function(){var e=[];e.push({label:"Product",property:"Product",type:l.String,width:50});e.push({label:"Product Code",type:l.String,property:"ProductCode"});e.push({property:["Packaging_Qty","Unit"],label:"Packing",type:l.String,width:10,template:"{0} {1}"});e.push({label:"Cost Price",property:"Cost_Price",type:l.Number,width:15});e.push({label:"Selling Price (incl. GST)",property:"Selling_Price",type:l.Number,scale:2,width:15});e.push({label:"Quantity",property:"Sell_Qty",type:l.Number,scale:2,width:15});e.push({label:"Total",property:"TotalPrice",type:l.Number,scale:2,width:15});return e},onPrntPrs:function(){let e=this.byId("idCustmrNm").getValue();if(!e){t.show("Enter Customer Name");return}const i=new Date;let o=this.byId("idTable");let l=o.getModel("InvoiceModel");let n=l.getProperty("/");const s=String(i.getDate()).padStart(2,"0");const a=String(i.getMonth()+1).padStart(2,"0");const c=String(i.getFullYear()).slice(-2);const g=`${s}${a}${c}`;e+="_"+g+"_"+this.byId("idTotlVal").getText();var p,d,u,h;d=o.getBinding("items");p=this.createColumnConfig();u={workbook:{context:{application:"Supplier Invoices List",version:"6.1.0-SNAPSHOT",title:"Supplier Invoices",modifiedBy:"Doe, John",sheetName:"Invoices"},columns:p,hierarchyLevel:"Level"},dataSource:d,fileName:e+".xlsx",worker:false};h=new r(u);h.build().finally(function(){h.destroy()})}})});
//# sourceMappingURL=CreateInvoice.controller.js.map